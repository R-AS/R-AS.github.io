{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blogs/nodejs/nodejs_1/","result":{"data":{"markdownRemark":{"html":"<h3 id=\"table-of-contents\">Table of Contents</h3>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#request-%E8%8E%B7%E5%8F%96%E6%95%B4%E4%B8%AA%E9%A1%B5%E9%9D%A2%E7%9A%84-html\">request 获取整个页面的 HTML</a></li>\n<li><a href=\"#cheerio-%E4%BB%8E-html-%E4%B8%AD%E6%88%AA%E5%8F%96%E9%9C%80%E8%A6%81%E7%9A%84%E8%B5%84%E6%96%99\">cheerio 从 HTML 中截取需要的资料</a></li>\n</ul>\n</div>\n<hr>\n<p>最近需要着手毕业设计, 但图书数据需要购买且数据量过大，因此利用两款插件(<a href=\"https://github.com/request/request\">request</a>, <a href=\"https://github.com/cheeriojs/cheerio\">cheerio</a>)来爬网页数据，下面展示一下:\n以<a href=\"https://book.douban.com/subject/34894380/\">豆瓣读书</a>为例</p>\n<h3 id=\"request-获取整个页面的-html\">request 获取整个页面的 HTML</h3>\n<ol>\n<li><strong>首先打开控制台, 找到所需的部分</strong></li>\n</ol>\n<p><img src=\"/blogs/nodejs/nodejs_1_pic_1.png\" alt=\"pic_1\"></p>\n<ol start=\"2\">\n<li><strong>观察 HTML 标签和 class</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"subject clearfix\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"mainpic\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>a <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"nbg\"</span> href<span class=\"token operator\">=</span><span class=\"token string\">\"https://img9.doubanio.com/view/subject/l/public/s33547055.jpg\"</span> title<span class=\"token operator\">=</span><span class=\"token string\">\"雾行者\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token string\">\"https://img9.doubanio.com/view/subject/l/public/s33547055.jpg\"</span> title<span class=\"token operator\">=</span><span class=\"token string\">\"点击看大图\"</span> alt<span class=\"token operator\">=</span><span class=\"token string\">\"雾行者\"</span> rel<span class=\"token operator\">=</span><span class=\"token string\">\"v:photo\"</span> style<span class=\"token operator\">=</span><span class=\"token string\">\"width: 135px;max-height: 200px;\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"info\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"pl\"</span><span class=\"token operator\">></span> 作者<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token operator\">:</span>\n        <span class=\"token operator\">&lt;</span>a <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span> href<span class=\"token operator\">=</span><span class=\"token string\">\"/author/573172\"</span><span class=\"token operator\">></span>路内<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"pl\"</span><span class=\"token operator\">></span>出版社<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span> 理想国 <span class=\"token operator\">|</span> 上海三联书店<span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"pl\"</span><span class=\"token operator\">></span>出品方<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>nbsp<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"https://book.douban.com/series/39057?brand=1\"</span><span class=\"token operator\">></span>理想国<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"pl\"</span><span class=\"token operator\">></span>出版年<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span> <span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"pl\"</span><span class=\"token operator\">></span>页数<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span> <span class=\"token number\">580</span><span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"pl\"</span><span class=\"token operator\">></span>定价<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span> <span class=\"token number\">88.00</span><span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"pl\"</span><span class=\"token operator\">></span>装帧<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span> 精装<span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"pl\"</span><span class=\"token operator\">></span><span class=\"token constant\">ISBN</span><span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span> <span class=\"token number\">9787542668547</span><span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></code></pre></div>\n<ol start=\"3\">\n<li><strong>用 request 抓取页面 HTML</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'request'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://book.douban.com/subject/34894380'</span>\n\n<span class=\"token function\">request</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> body</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>可看到 request 拿到了整个网页的 body, 这是可以利用 cheerio 来截取需要的部分了</p>\n<p><img src=\"/blogs/nodejs/nodejs_1_pic_2.png\" alt=\"pic_2\"></p>\n<h3 id=\"cheerio-从-html-中截取需要的资料\">cheerio 从 HTML 中截取需要的资料</h3>\n<p><strong>观察 HTML 结构, 发现只需要取 div.subject 下的 div#info 的信息就可以了, 但需要过滤掉 span.pl</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'request'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> cheerio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cheerio'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> trim <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../utils'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// 自己分装的函数, 用来格式化取出的文字</span>\n\n<span class=\"token function\">request</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> body</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> details <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  \n  <span class=\"token comment\">// 拷贝基本信息</span>\n  <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.pl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.subject #info'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i<span class=\"token punctuation\">,</span> el</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n    item <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span> <span class=\"token operator\">=></span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    item <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span> <span class=\"token operator\">=></span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    details <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>details<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>可看到已经获取到图书的基本信息</p>\n<p><img src=\"/blogs/nodejs/nodejs_1_pic_3.png\" alt=\"pic_3\">\n<img src=\"/blogs/nodejs/nodejs_1_pic_4.png\" alt=\"pic_4\"></p>\n<p>这样我们就可以建下数据库, 把数据存进去了，省事～</p>\n<hr>\n<p><strong>本文参考自</strong></p>\n<ul>\n<li><a href=\"https://larrylu.blog/nodejs-request-cheerio-weather-414e33f45c7d\">https://larrylu.blog/nodejs-request-cheerio-weather-414e33f45c7d</a></li>\n<li><a href=\"https://cheerio.js.org/\">https://cheerio.js.org/</a></li>\n</ul>","frontmatter":{"title":"NodeJS 爬网页数据","date":"2020-01-14","type":"nodejs"},"excerpt":"Table of Contents request 获取整个页面的 HTML cheerio 从 HTML 中截取需要的资料 最近需要着手毕业设计, 但图书数据需要购买且数据量过大，因此利用两款插件(request, cheerio…","fields":{"readingTime":{"text":"1 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/nodejs/nodejs_1/"}}}