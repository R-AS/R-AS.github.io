{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blogs/css/css_1/","result":{"data":{"markdownRemark":{"html":"<p><strong>最近在做弹窗的时候设计要求弹窗主图可自适应缩放，滚动时图片不要离开视窗区域，且当图片高度超出屏幕时滚动可展示剩余图片部分</strong>\n<strong>总的来说就是关于吸顶和吸底的问题，然后看似简单，做起来的时候却反而想复杂了...</strong></p>\n<p>以下是 demo 的效果， 右边是搭配商品， 左边是搭配主图</p>\n<p>页面初始状态：\n<img src=\"/blogs/css/css_1_pic_1.png#pic_center\" alt=\"pic_1\"></p>\n<p>当图片高度小于视窗高度时，滚动吸顶\n<img src=\"/blogs/css/css_1_pic_2.png#pic_center\" alt=\"pic_2\"></p>\n<p>当图片高度大于视窗高度时，滚动展示图片剩余部分，展示完吸底\n<img src=\"/blogs/css/css_1_pic_3.png#pic_center\" alt=\"pic_3\"></p>\n<p>一开始想复杂了，把主图放到一个可滚动容器，然后先静止滚动，全局滚动时允许图片容器滚动，当时呈现出来的滚动效果不太好，且会存在浏览器兼容的问题。</p>\n<p>再之，同事建议我滚动的时候让图片 translateY，这样来达到吸顶的效果，但这样不能展示图片剩余部分，且在一个 overflow: scroll 的容器里让图片 translateY， 有可能会遇到图片高度大于视窗时，overflow 容器一直有图片移除，导致容器一直可滚动。最麻烦的是，测试最后发现在 mac chrome 上 使用滚动值传递给 translateY 会出现抖动的效果，这可能和 mac 触摸板的滚动频率有关。</p>\n<p>其实一开始可以使用给主图部分加个绝对定位的，但由于还需要图片自适应，所以就使用了 flex 布局， 绝对定位会脱离文档流，这样自适应就没办法了，最后弃用了 flex <strong>（开发前必须想清楚技术方案，即使是优先级很低的功能，路线走错后带给你的将会是加班...）</strong></p>\n<p><strong>那接下来谈谈我的解决方案：</strong>\n主图部分 fixed, 并且相对右边列表 right, 即可自适应</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"html\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">html&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">head&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">style&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      .content {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        padding: 40px 20px;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      .content-img-wrap {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        display: block;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        position: fixed;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        right: 45%;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      .content-img {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        display: block;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        width: 100%;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        max-width: 800px;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      .content-list {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        display: flex;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        margin-left: 54%;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        width: 582px;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        justify-content: center;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        flex-wrap: wrap;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      .list-item {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        margin: 10px;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        width: 250px;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        height: 300px;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        border: 1px solid;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/style&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/head&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">body&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;container&quot;&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;close&quot;&gt;X</span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;content&quot;&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;content-img-wrap&quot;&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">            </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">img class=&quot;content-img&quot; src=&quot;./timg.jpeg&quot; alt=&quot;&quot; /&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;content-list&quot;&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">            </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;list-item&quot;&gt;</span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">            </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;list-item&quot;&gt;</span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">            </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;list-item&quot;&gt;</span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">            </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;list-item&quot;&gt;</span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">            </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;list-item&quot;&gt;</span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">            </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">div class=&quot;list-item&quot;&gt;</span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/div&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/body&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk14\">&lt;</span><span class=\"mtk1\">/html&gt;</span></span></code></pre>\n<p><strong>滚动部分通过 js 计算，有两种情况：</strong></p>\n<ol>\n<li>图片高度超过视窗：</li>\n<li>当 滚动值 与 图片与页面顶部距离 的差 &#x3C;= 0 时， top: 0</li>\n<li>当 滚动值 与 图片与页面顶部距离 的差 > 0 时， top: 图片与页面顶部的距离 - 滚动值</li>\n<li>图片高度超过视窗：</li>\n<li>当 滚动值 + 视窗高度 >= 图片高度 时， top: -(图片高度 - 视窗高度)</li>\n<li>当 滚动值 + 视窗高度 &#x3C;= 图片高度 时， top: 图片与页面顶部的距离 - 滚动值</li>\n</ol>\n<p>以下是具体代码：</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk11\">$</span><span class=\"mtk1\">(</span><span class=\"mtk12\">document</span><span class=\"mtk1\">).</span><span class=\"mtk11\">ready</span><span class=\"mtk1\">(</span><span class=\"mtk4\">function</span><span class=\"mtk1\">() {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">content</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">$</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;.content&#39;</span><span class=\"mtk1\">)</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">imgWrap</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">$</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;.content-img-wrap&#39;</span><span class=\"mtk1\">)</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">contentPT</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">content</span><span class=\"mtk1\">.</span><span class=\"mtk11\">css</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;paddingTop&#39;</span><span class=\"mtk1\">).</span><span class=\"mtk11\">split</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;px&#39;</span><span class=\"mtk1\">))[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk11\">$</span><span class=\"mtk1\">(</span><span class=\"mtk12\">window</span><span class=\"mtk1\">).</span><span class=\"mtk11\">bind</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;scroll&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">function</span><span class=\"mtk1\">() {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">imgHeight</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">imgWrap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">height</span><span class=\"mtk1\">()</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">viewHeight</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">$</span><span class=\"mtk1\">(</span><span class=\"mtk12\">window</span><span class=\"mtk1\">).</span><span class=\"mtk11\">height</span><span class=\"mtk1\">()</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">scrollTop</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">$</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">).</span><span class=\"mtk11\">scrollTop</span><span class=\"mtk1\">()</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">miuns</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">contentPT</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">scrollTop</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// 图片高度超过视窗，展示剩余图片并吸低，若小于视窗高度则吸顶</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">imgHeight</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">viewHeight</span><span class=\"mtk1\">) {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk12\">imgWrap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">css</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;top&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">miuns</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> ? </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">miuns</span><span class=\"mtk1\">)</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">scrollTop</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">viewHeight</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">imgHeight</span><span class=\"mtk1\">) {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk12\">imgWrap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">css</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;top&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">`-</span><span class=\"mtk4\">${</span><span class=\"mtk12\">imgHeight</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">viewHeight</span><span class=\"mtk4\">}</span><span class=\"mtk8\">px`</span><span class=\"mtk1\">)</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk12\">imgWrap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">css</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;top&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">miuns</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> ? </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">miuns</span><span class=\"mtk1\">)</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  })</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">})</span></span></code></pre>\n<p><strong>结论： 不要把简单的事情复杂化！</strong> </p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n  }\n  \n  .grvsc-code {\n    display: inline-block;\n    min-width: 100%;\n  }\n  \n  .grvsc-line {\n    display: inline-block;\n    box-sizing: border-box;\n    width: 100%;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-line-highlighted {\n    background-color: var(--grvsc-line-highlighted-background-color, transparent);\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, transparent);\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk14 { color: #F44747; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n</style>","frontmatter":{"title":"页面样式记录","date":"2020-06-13","type":"css"},"excerpt":"最近在做弹窗的时候设计要求弹窗主图可自适应缩放，滚动时图片不要离开视窗区域，且当图片高度超出屏幕时滚动可展示剩余图片部分\n总的来说就是关于吸顶和吸底的问题，然后看似简单，做起来的时候却反而想复杂了... 以下是 demo…","fields":{"readingTime":{"text":"2 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/css/css_1/"}}}